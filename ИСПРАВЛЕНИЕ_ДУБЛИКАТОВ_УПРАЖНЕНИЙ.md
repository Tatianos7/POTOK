# Исправление дубликатов упражнений

## Проблема:
В списке упражнений отображались дубликаты:
- Одно и то же упражнение повторялось несколько раз
- Часть дублей отображалась без целевой мышцы
- Часть — с целевой мышцей

## Решение:

### 1. SQL View (`supabase/workout_schema.sql`)
- ✅ Исправлен `exercises_full_view` для правильной дедупликации
- ✅ Добавлена группировка по названию упражнения и категории
- ✅ Приоритет: упражнения с мышцами > упражнения без мышц
- ✅ Удалены NULL значения из массива мышц

### 2. Сервис загрузки данных (`src/services/exerciseService.ts`)
- ✅ Добавлена дедупликация в методе `getExercisesByCategory` (через view)
- ✅ Добавлена дедупликация в методе `getExercisesByCategoryDirect` (fallback)
- ✅ Добавлена дедупликация в методе `searchExercises`
- ✅ Приоритет: версии с мышцами имеют приоритет над версиями без мышц
- ✅ Если есть упражнения с мышцами, упражнения без мышц не возвращаются

### 3. UI компонент (`src/components/ExerciseListSheet.tsx`)
- ✅ Добавлена дополнительная дедупликация на уровне компонента
- ✅ Группировка упражнений по названию
- ✅ Приоритет версий с мышцами над версиями без мышц
- ✅ Фильтрация упражнений без мышц, если есть версии с мышцами

## Результат:

✅ Каждое упражнение отображается только один раз  
✅ Упражнения всегда отображаются с целевой мышцей (если она есть)  
✅ Упражнения без мышц не отображаются, если есть версия с мышцами  
✅ Формат отображения: "Название упражнения — Целевая мышца"  
✅ Работает для всех категорий (плечи, руки, грудь, спина, ноги, пресс, кардио)  

## Как проверить:

1. Откройте страницу "Дневник тренировок"
2. Нажмите кнопку "+" (Добавить упражнение)
3. Выберите любую категорию (например, "НОГИ")
4. Убедитесь, что:
   - Каждое упражнение встречается только один раз
   - Все упражнения отображаются с целевой мышцей (формат: "Название — Мышца")
   - Нет упражнений без целевой мышцы

## Технические детали:

### Дедупликация работает на трех уровнях:

1. **SQL View** - группирует упражнения по названию на уровне базы данных
2. **Сервис** - дедуплицирует при загрузке данных из базы
3. **Компонент** - финальная дедупликация на уровне UI для надежности

### Логика приоритета:

1. Если есть версия с мышцами и версия без мышц → используется версия с мышцами
2. Если есть несколько версий с мышцами → объединяются уникальные мышцы
3. Если все версии без мышц → используются все (на случай, если мышцы еще не добавлены)

### Устойчивость к будущим изменениям:

- Логика автоматически работает с новыми упражнениями
- Если добавляется новое упражнение, оно автоматически дедуплицируется
- Если у существующего упражнения добавляются мышцы, версия с мышцами заменит версию без мышц

