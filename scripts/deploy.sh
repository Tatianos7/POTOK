#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ GitHub Pages

set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞—é –¥–µ–ø–ª–æ–π –Ω–∞ GitHub Pages..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞."
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ git –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
if [ ! -d ".git" ]; then
  echo "üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
  git init
fi

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üìù –î–æ–±–∞–≤–ª—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git..."
git add -A

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
if git diff --staged --quiet; then
  echo "‚ÑπÔ∏è  –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞."
else
  # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
  echo "üíæ –°–æ–∑–¥–∞—é –∫–æ–º–º–∏—Ç..."
  git commit -m "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏ –∑–∞–º–µ—Ä–æ–≤ —Å Supabase" || echo "–ö–æ–º–º–∏—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
if git remote | grep -q origin; then
  echo "üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitHub..."
  git push origin main || git push origin master || echo "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è."
else
  echo "‚ö†Ô∏è  –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω."
  echo "–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–∏:"
  echo "  git remote add origin https://github.com/–¢–í–û–ô_USERNAME/POTOK.git"
  echo "  git branch -M main"
  echo "  git push -u origin main"
fi

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–æ–±–∏—Ä–∞—é –ø—Ä–æ–µ–∫—Ç..."
npm run build

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω –≤ –ø–∞–ø–∫–µ dist/"
echo ""
echo "–î–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ GitHub Pages:"
echo "1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ GitHub"
echo "2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤–∫–ª—é—á–∏ GitHub Pages"
echo "3. –í—ã–±–µ—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫: GitHub Actions"
echo "4. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π gh-pages: npm install -g gh-pages && gh-pages -d dist"

