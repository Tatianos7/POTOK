# Sprint 8.1.2 — AI Coach Interaction Engine

Цель: запустить живой слой коуча поверх экранов, не как чат‑бот, а как
эмоциональный навигатор пути.

## A) Event → Emotion → Response Pipeline
**UI события, которые вызывают коуча**
- пропуск дня
- плато в прогрессе
- снижение доверия
- боль / усталость
- возврат после паузы
- первый день плана
- отмена плана
- успех

**Emotion Router**
- определяет доминирующее состояние: риск, усталость, устойчивость, рост
- выбирает режим (см. B)

**Response Selector**
- тип ответа: поддержка, вопрос, микро‑план, пауза, объяснение
- форма: карточка, баннер, диалог, drawer

## B) Emotional Modes (Calm Power Coach)
- **Care** — мягкая забота, снижение давления
- **Support** — поддержка ритма и возвращения
- **Firm Guidance** — ясные границы и небольшой вызов
- **Recovery** — восстановление и защита
- **Confidence Boost** — укрепление уверенности
- **Safety Hold** — остановка и безопасность
- **Celebration** — тихое признание успеха

## C) Mapping на экраны
**Today**
- микро‑вставки в план дня
- баннеры состояния
- bottom‑sheet для объяснения

**Progress**
- инсайт‑карточки + комментарий коуча

**Habits**
- поддержка при срыве и в streak‑режиме

**My Program**
- объяснение адаптаций и причин изменений

**Paywall**
- мотивационное объяснение ценности без давления

**Profile**
- доверие, безопасность, контроль над памятью

## D) UI Components для Коуча
- **CoachCard** — короткий ответ/совет в карточке
- **CoachNudge** — мягкий nudging‑баннер
- **CoachDialog** — короткий диалог (2–3 шага)
- **CoachTimelineComment** — заметка коуча в таймлайне
- **CoachExplainabilityLayer** — “почему так” + уверенность

## E) Safety & Trust Gate
**Когда коуч молчит**
- низкий trust score
- кризисные флаги
- отсутствие согласия на чувствительные темы

**Когда снижает тон**
- тревога, усталость, регресс

**Когда предлагает паузу**
- признаки выгорания или боли

**Когда включает “медицинский” режим**
- медицинские риски и red‑flags

## F) Premium Logic
**Free**
- короткий коуч‑комментарий
- базовое объяснение причины

**Premium**
- полный контекст, объяснения и альтернативы
- персонализированные микро‑планы
- более глубокий тональный слой

**Личный коуч**
- включается в Premium как устойчивый диалоговый слой
- сохраняет долгосрочную память (по согласию)

## Минимальный набор компонентов для первой реализации
- `CoachCard`
- `CoachNudge`
- `CoachExplainabilityLayer`

## Первые экраны
- **Today** (базовые микро‑вставки + баннер)
- **Progress** (инсайт‑карточки + комментарий)

## Подготовка к Sprint 8.1.3 — AI Coach Runtime
- спецификация формата события (event DTO)
- контракт ответа (coach response DTO)
- модель состояния (mood/trust/energy)
- правила рендера для UI‑компонентов
