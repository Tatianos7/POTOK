#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ GitHub

set -e

echo "üöÄ –ù–∞—á–∏–Ω–∞—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ GitHub..."

cd "$(dirname "$0")"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞."
  exit 1
fi

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º git, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if [ ! -d ".git" ]; then
  echo "üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
  git init
fi

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üìù –î–æ–±–∞–≤–ª—è—é –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git add -A

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo ""
echo "üìä –°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω–∏–π:"
git status --short

# –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
echo ""
echo "üíæ –°–æ–∑–¥–∞—é –∫–æ–º–º–∏—Ç..."
git commit -m "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∑–∞–º–µ—Ä–æ–≤ —Å Supabase

- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ user_profiles –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–∞–º–µ—Ä–æ–≤ (user_measurements, measurement_history, measurement_photo_history)
- –°–æ–∑–¥–∞–Ω profileService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω measurementsService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ ReferenceError –∏ 406 –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- –û–±–Ω–æ–≤–ª–µ–Ω disable_rls.sql –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤ —Å Supabase
- –î–æ–±–∞–≤–ª–µ–Ω GitHub Actions workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è" || echo "‚ö†Ô∏è  –ö–æ–º–º–∏—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è—é —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
if git remote | grep -q origin; then
  REMOTE_URL=$(git remote get-url origin)
  echo "‚úÖ –ù–∞–π–¥–µ–Ω —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: $REMOTE_URL"
  
  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
  CURRENT_BRANCH=$(git branch --show-current 2>/dev/null || echo "main")
  if [ -z "$CURRENT_BRANCH" ]; then
    CURRENT_BRANCH="main"
    git branch -M main 2>/dev/null || true
  fi
  
  echo "üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ç–∫—É $CURRENT_BRANCH..."
  git push -u origin "$CURRENT_BRANCH" 2>&1 || {
    echo "‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."
    echo ""
    echo "–í—ã–ø–æ–ª–Ω–∏ –≤—Ä—É—á–Ω—É—é:"
    echo "  git push -u origin $CURRENT_BRANCH"
    echo ""
    echo "–ò–ª–∏ –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π push:"
    echo "  git push -u origin $CURRENT_BRANCH --force"
  }
else
  echo "‚ö†Ô∏è  –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω."
  echo ""
  echo "–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω–∏:"
  echo "  git remote add origin https://github.com/–¢–í–û–ô_USERNAME/POTOK.git"
  echo "  git branch -M main"
  echo "  git push -u origin main"
fi

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–∞ GitHub"
echo "2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Settings ‚Üí Pages) –≤—ã–±–µ—Ä–∏ 'GitHub Actions' –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫"
echo "3. GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –ø—Ä–æ–µ–∫—Ç"

